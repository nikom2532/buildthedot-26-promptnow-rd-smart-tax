<?xml version="1.0" encoding="UTF-8"?>

<project  xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
          xmlns='http://xml.netbeans.org/schema/config-schema'
          xsi:schemaLocation='http://xml.netbeans.org/schema/config-schema config-schema.xsd' name="">
    <meta>
        <database-type>mssql</database-type>    
        <database-url>27.254.41.30</database-url>
        <database-name>RD_Smart</database-name>
        <database-username>rdsmart</database-username>
        <database-password>rdsmart1234!</database-password>
        <database-port>1433</database-port>
    </meta>
    
    <package name="com.promptnow.rdsmart.db">
        
        <class name="DataMapping">
            <query name="getDeviceTypeID" return="DeviceTypeID">
                <sql><![CDATA[SELECT DEVICE_TYPE_IDS FROM DEVICE_MASTER WHERE DEVICE_TYPE_NAME=? ]]></sql>
                <param type="String">device_type_name</param>
            </query>
            
            <query name="getAllDeviceTypeID" return="AllDeviceTypeID">
                <sql><![CDATA[SELECT * from DEVICE_MASTER ]]></sql>
            </query>
        </class>
        
        <class name="UserProfileDB">
            <update name="insertUserProfile">
                <sql><![CDATA[INSERT INTO USER_PROFILE (NID, USERNAME, DEVICE_ID, DEVICE_TYPE_IDS, DEVICE_USER_AGENT, LAST_LOGIN_DATETIME, SESSION_VALUE, LAST_ACCESS, LAST_ACCESS_MS) VALUES (?,LOWER(?),?,?,?, ?,?,?,?)]]></sql>
                <param type="String">nID</param>
                <param type="String">username</param>
                <param type="String">deviceID</param>
                <param type="int">deviceType</param>
                <param type="String">deviceUserAgent</param>
                <param type="String">lastLoginDateTime</param>
                <param type="String">sessionID</param>
                <param type="String">lastAccess</param>
                <param type="String">lastAccessMS</param>     
            </update>            
            <update name="updateUserProfile">
                <sql><![CDATA[UPDATE USER_PROFILE SET NID=?, DEVICE_ID=?, DEVICE_TYPE_IDS=?, DEVICE_USER_AGENT=?, LAST_LOGIN_DATETIME=?, SESSION_VALUE=?, LAST_ACCESS=GETDATE(), LAST_ACCESS_MS=? WHERE LOWER(USERNAME)=LOWER(?)]]></sql>
                <param type="String">nID</param>
                <param type="String">deviceID</param>
                <param type="int">deviceType</param>
                <param type="String">deviceUserAgent</param>
                <param type="String">lastLoginDateTime</param>
                <param type="String">sessionID</param>
                <param type="String">lastAccessMS</param>
                <param type="String">username</param>
            </update>            
            <update name="updateUserLoginTime">
                <sql><![CDATA[UPDATE USER_PROFILE SET LAST_LOGIN_DATETIME=? WHERE LOWER(USERNAME)=LOWER(?)]]></sql>
                <param type="String">lastLoginDateTime</param>
                <param type="String">username</param>
            <!--
                <sql><![CDATA[UPDATE USER_PROFILE SET LAST_LOGIN_DATETIME=SYSDATA() WHERE LOWER(USERNAME)=LOWER(?) AND DEVICE_ID=?]]></sql>
                <param type="String">username</param>
                <param type="String">deviceID</param>
            -->                
            </update>
            <update name="updateUserLogoutTime">
                <sql><![CDATA[UPDATE USER_PROFILE SET LAST_LOGOUT_DATETIME=?, SESSION_VAULE=NULL WHERE LOWER(USERNAME)=LOWER(?)]]></sql>
                <param type="String">lastLoginDateTime</param>
                <param type="String">username</param>       
            </update>
            
            <update name="updateUserSession">
                <sql><![CDATA[UPDATE USER_PROFILE SET LAST_ACCESS=SYSDATA(), LAST_ACCESS_MS=? WHERE LOWER(USERNAME)=LOWER(?)]]></sql>
                <param type="String">lastAccessMS</param>
                <param type="String">username</param>               
            </update>
            
            <query name="checkUserSession">
                <sql><![CDATA[SELECT NID FROM USER_PROFILE WHERE LOWER(USERNAME)=LOWER(?) AND SESSION_VALUE=?]]></sql>
                <param type="String">username</param>
                <param type="String">sessionID</param>
            </query>    
        </class>
        
        
        <!--   
        <class name="UserDeviceDB">
            <query name="getUserDevice">
                <sql><![CDATA[select * from USER_DEVICE where LOWER(USERNAME)=LOWER(?)  and DEVICE_ID=?  ]]>                  
                </sql>
                <param type="String">username</param>
                <param type="String">deviceID</param>

            </query>
                         
            <update name="updateLastUsed">
                <sql><![CDATA[update USER_DEVICE set LAST_USED_DATETIME=SYSDATE  where LOWER(USERNAME)=LOWER(?)  and DEVICE_ID=?  ]]>                  
                </sql>
                <param type="String">username</param>
                <param type="String">deviceID</param>

            </update>
             
            <update name="updateActivateDatetime">
                <sql><![CDATA[update USER_DEVICE set ACTIVATE_DATETIME=SYSDATE  where LOWER(USERNAME)=LOWER(?)  and DEVICE_ID=?  ]]>                  
                </sql>
                <param type="String">username</param>
                <param type="String">deviceID</param>
            </update>
             
            <update name="updateDeActivateDatetime">
                <sql><![CDATA[update USER_DEVICE set DEACTIVE_DATETIME=SYSDATE  where LOWER(USERNAME)=LOWER(?)  and DEVICE_ID=?  ]]>                  
                </sql>
                <param type="String">username</param>
                <param type="String">deviceID</param>
            </update>
             
            <update name="updateUserStatus">
                <sql><![CDATA[update USER_DEVICE set USER_STATUS=?  where LOWER(USERNAME)=LOWER(?)  and DEVICE_ID=?  ]]>                  
                </sql>
                <param type="String">userStatus</param>
                <param type="String">username</param>
                <param type="String">deviceID</param>
            </update>
        </class>
        -->

        <class name="EventLoggingDB">
            <update name="insertLog">
                <sql><![CDATA[INSERT INTO EVENT_LOGGING (USERNAME, LOG_DATETIME,LOG_KEYWORD,LOG_REQ_DETAIL,LOG_RES_DETAIL,EVENT_SOURCE_IP,DEVICE_TYPE_IDS,DEVICE_USER_AGENT,DEVICE_IDS,LATITUDE,LONGITUDE,RESPONSE_STATUS,RESPONSE_CODE,RESPONSE_MESSAGE,REMARK,SESSION_ID) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)]]></sql>
                <param type="String">userName</param>
                <param type="String">logDateTime</param>
                <param type="String">logKeyWord</param>
                <param type="String">logReqDetail</param>
                <param type="String">logResDetail</param>
                <param type="String">eventSourceIP</param>
                <param type="int">deviceTypeID</param>
                <param type="String">deviceUserAgent</param>
                <param type="String">deviceID</param>
                <param type="String">latitude</param>
                <param type="String">longitude</param>
                <param type="String">responseStatus</param>
                <param type="String">responseCode</param>
                <param type="String">responseMessage</param>
                <param type="String">remark</param>
                <param type="String">session</param>
            </update>
        </class>        
 
    </package>
</project>
